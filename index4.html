<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connect Four — Web Game + Simple AI (Fixed)</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --muted:#9aa4b2;
      --accent:#ffcc00;
      --player1:#f43f5e; /* red-ish */
      --player2:#06b6d4; /* teal-ish */
      --cell:#0b1320;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      min-height:100vh;
      background: linear-gradient(180deg,var(--bg),#071021 60%);
      color:#e6eef6;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    .app{width:100%;max-width:1400px;display:grid;grid-template-columns:360px 1fr;gap:20px;align-items:start}
    .panel{background:linear-gradient(180deg,var(--panel), #07101b);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 8px 0;font-size:20px;letter-spacing:0.2px}
    p.lead{color:var(--muted);margin:0 0 16px 0;font-size:13px}

    .players{display:flex;flex-direction:column;gap:12px}
    .player-row{display:flex;gap:8px;align-items:center}
    .color-swatch{width:34px;height:34px;border-radius:50%;box-shadow:inset 0 -6px rgba(0,0,0,0.25);border:2px solid rgba(255,255,255,0.03)}
    .player-input{flex:1}
    input[type=text], select{ width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; font-size:14px }

    .controls{display:flex;gap:8px;margin-top:14px}
    button{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#ffb020);color:#07101b}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .scoreboard{display:flex;gap:12px;margin-top:14px}
    .score{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;flex:1;text-align:center}
    .notice{margin-top:12px;color:var(--muted);font-size:13px}

    /* Board area */
    .board-wrap{display:flex;flex-direction:column;align-items:stretch;gap:12px}
    .board{background:linear-gradient(180deg,#05314a 0%, #023045 100%);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);min-height:420px;display:flex;flex-direction:column;gap:12px}

    /* grid fixed: use border-box so width calculations behave, and ensure visible */
    .grid{display:grid;grid-template-columns:repeat(7,72px);grid-auto-rows:72px;gap:10px;background:linear-gradient(180deg,#03283a 0,#042a3e 100%);padding:12px;border-radius:8px;border:6px solid rgba(0,0,0,0.35);align-self:center;box-sizing:border-box}

    .cell{width:72px;height:72px;border-radius:50%;background:var(--cell);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;box-shadow:inset 0 -6px rgba(0,0,0,0.5)}
    .disc{width:64px;height:64px;border-radius:50%;background:transparent;box-shadow:inset 0 -8px rgba(0,0,0,0.35);transition:transform 300ms cubic-bezier(.2,.9,.2,1), background 160ms, box-shadow 160ms}

    /* explicit disc colors (use CSS, avoid inline style overrides) */
    .disc.empty{background:transparent}
    .disc.p1{background:linear-gradient(180deg,var(--player1),#b82b43)}
    .disc.p2{background:linear-gradient(180deg,var(--player2),#0a97a7)}

    .col-indicators{display:grid;grid-template-columns:repeat(7,72px);gap:10px;justify-content:center;margin-bottom:6px;width:100%}
    .col-button{width:72px;height:32px;border-radius:8px;background:transparent;border:1px dashed rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted);font-weight:700}
    .col-button:hover{background:rgba(255,255,255,0.02)}

    .turn{margin-top:8px;font-size:15px}
    .turn .dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:8px;vertical-align:middle}

    @media (max-width:880px){ .app{grid-template-columns:1fr;} .grid{transform:scale(0.9);} .board{min-height:360px} }
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel">
      <h1>Connect Four</h1>
      <p class="lead">Two players or play vs a simple AI.</p>

      <div class="players">
        <div class="player-row">
          <div class="color-swatch" id="sw1" title="Player 1 color"></div>
          <div class="player-input">
            <label style="font-size:12px;color:var(--muted)">Player 1</label>
            <input id="name1" type="text" value="Player 1" />
          </div>
        </div>
        <div class="player-row">
          <div class="color-swatch" id="sw2" title="Player 2 color"></div>
          <div class="player-input">
            <label style="font-size:12px;color:var(--muted)">Player 2</label>
            <input id="name2" type="text" value="Player 2" />
          </div>
        </div>
        <div class="player-row">
          <label style="font-size:12px;color:var(--muted);width:100%">Player 2 Mode</label>
          <select id="p2mode">
            <option value="human">Human</option>
            <option value="ai">AI (Simple)</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center;">
        <button id="newGame" class="btn-primary">New Game</button>
        <button id="resetScore" class="btn-ghost">Reset Score</button>
      </div>

      <div class="scoreboard">
        <div class="score">
          <div style="font-size:12px;color:var(--muted)">Wins</div>
          <div class="num" id="score1">0</div>
          <div style="font-size:12px;color:var(--muted)" id="label1">Player 1</div>
        </div>
        <div class="score">
          <div style="font-size:12px;color:var(--muted)">Wins</div>
          <div class="num" id="score2">0</div>
          <div style="font-size:12px;color:var(--muted)" id="label2">Player 2</div>
        </div>
      </div>

      <div class="notice">Tip: Click a column to drop a disc. You can also use the number keys 1–7 to drop in that column.</div>

    </aside>

    <main class="panel board-wrap">
      <div style="display:flex;align-items:center;justify-content:space-between;width:100%">
        <div>
          <div class="turn" id="turnText"><span class="dot" id="turnDot" style="background:var(--player1)"></span><strong id="turnName">Player 1</strong>'s turn</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div id="message" style="color:var(--muted)"></div>
        </div>
      </div>

      <div class="board" id="boardArea">
        <div class="col-indicators" id="colBtns"></div>
        <div class="grid" id="grid" aria-label="Connect four grid"></div>
      </div>
    </main>
  </div>

  <script>
const ROWS=6, COLS=7;
let board=[], currentPlayer=1, isGameOver=false, scores={1:0,2:0};
const gridEl=document.getElementById('grid');
const colBtnsEl=document.getElementById('colBtns');
const turnNameEl=document.getElementById('turnName');
const turnDot=document.getElementById('turnDot');
const messageEl=document.getElementById('message');
const score1El=document.getElementById('score1');
const score2El=document.getElementById('score2');
const name1El=document.getElementById('name1');
const name2El=document.getElementById('name2');
const label1El=document.getElementById('label1');
const label2El=document.getElementById('label2');
const p2mode=document.getElementById('p2mode');
const sw1=document.getElementById('sw1');
const sw2=document.getElementById('sw2');
const color1=getComputedStyle(document.documentElement).getPropertyValue('--player1').trim();
const color2=getComputedStyle(document.documentElement).getPropertyValue('--player2').trim();

function initBoard(){
 board=Array.from({length:ROWS},()=>Array(COLS).fill(0));
 isGameOver=false; currentPlayer=1;
 messageEl.textContent='';
 renderGrid(); renderColButtons(); updateTurnUI(); loadScores(); syncLabels();
 // set swatches (ensure visible)
 sw1.style.background = color1;
 sw2.style.background = color2;
}

function syncLabels(){
  label1El.textContent=name1El.value||'Player 1';
  label2El.textContent=name2El.value||'Player 2';
  turnNameEl.textContent=currentPlayer===1?(name1El.value||'Player 1'):(name2El.value||'Player 2');
}

function renderGrid(){
  gridEl.innerHTML='';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const cell=document.createElement('div');
      cell.className='cell';
      cell.dataset.r=r; cell.dataset.c=c;
      const disc=document.createElement('div');
      disc.className='disc empty';
      disc.dataset.r=r; disc.dataset.c=c;
      cell.appendChild(disc);
      gridEl.appendChild(cell);
    }
  }
  refreshDiscs();
}

function renderColButtons(){
  colBtnsEl.innerHTML='';
  for(let c=0;c<COLS;c++){
    const b=document.createElement('button');
    b.className='col-button';
    b.textContent=c+1;
    b.addEventListener('click', ()=>handleDrop(c));
    colBtnsEl.appendChild(b);
  }
}

function refreshDiscs(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const d=gridEl.querySelector(`.disc[data-r='${r}'][data-c='${c}']`);
      if(!d) continue;
      // remove any p1/p2/empty then apply correct class only
      d.classList.remove('p1','p2','empty');
      if(board[r][c]===0) d.classList.add('empty');
      else if(board[r][c]===1) d.classList.add('p1');
      else d.classList.add('p2');
      // avoid inline background overrides so CSS controls colors
      d.style.transform = 'translateY(0)';
      d.style.background = '';
    }
  }
}

function handleDrop(c, byAI = false){
  if(isGameOver) return;
  // prevent human clicks when it's AI's turn; allow AI when byAI=true
  if(currentPlayer===2 && p2mode.value==='ai' && !byAI) return;
  // drop
  for(let r=ROWS-1;r>=0;r--){
    if(board[r][c]===0){
      board[r][c]=currentPlayer;
      animateDrop(r,c,currentPlayer);
      setTimeout(()=>{
        refreshDiscs();
        if(checkWin(r,c,currentPlayer)) onWin(currentPlayer);
        else if(checkDraw()) onDraw();
        else{
          currentPlayer = currentPlayer===1?2:1;
          updateTurnUI();
          // if AI's turn, trigger AI (only if it's now AI's turn)
          if(currentPlayer===2 && p2mode.value==='ai' && !isGameOver) aiMove();
        }
      }, 260);
      return;
    }
  }
  flashMessage('Column full');
}

function animateDrop(r,c,player){
  const d=gridEl.querySelector(`.disc[data-r='${r}'][data-c='${c}']`);
  if(!d) return;
  d.classList.remove('empty');
  d.classList.add(player===1?'p1':'p2');
  // rely on CSS class for background — do not set inline background
  d.style.transform='translateY(-150px)';
  void d.offsetWidth;
  setTimeout(()=> d.style.transform='translateY(0)', 10);
}

function updateTurnUI(){
  turnDot.style.background=currentPlayer===1?color1:color2;
  syncLabels();
}

function flashMessage(msg){ messageEl.textContent=msg; setTimeout(()=>{ if(messageEl.textContent===msg) messageEl.textContent=''; },1200); }
function checkDraw(){ return board.every(r=>r.every(c=>c!==0)); }

function inBounds(r,c){ return r>=0&&r<ROWS&&c>=0&&c<COLS; }

function checkWin(r,c,p){
  const dirs=[[0,1],[1,0],[1,1],[1,-1]];
  for(const [dr,dc] of dirs){
    let count=1;
    let rr=r+dr, cc=c+dc;
    while(inBounds(rr,cc) && board[rr][cc]===p){ count++; rr+=dr; cc+=dc; }
    rr = r-dr; cc = c-dc;
    while(inBounds(rr,cc) && board[rr][cc]===p){ count++; rr-=dr; cc-=dc; }
    if(count>=4) return true;
  }
  return false;
}

function onWin(p){
  isGameOver=true;
  flashMessage((p===1?(name1El.value||'Player 1'):(name2El.value||'Player 2'))+' wins!');
  scores[p]++;
  saveScores(); updateScoreboard();
}

function onDraw(){ isGameOver=true; flashMessage('Draw'); }

function updateScoreboard(){ score1El.textContent=scores[1]; score2El.textContent=scores[2]; }
function saveScores(){ try{ localStorage.setItem('connect4_scores',JSON.stringify(scores)); }catch(e){} }
function loadScores(){ try{ const s=JSON.parse(localStorage.getItem('connect4_scores')); if(s && typeof s === 'object'){ scores = Object.assign({1:0,2:0}, s); } }catch(e){} updateScoreboard(); }

// --- SIMPLE AI (random + block immediate opponent win) ---
function aiMove(){
  // small delay to feel natural
  setTimeout(()=>{
    if(isGameOver) return;
    // gather valid columns
    const valid = [];
    for(let c=0;c<COLS;c++) if(board[0][c]===0) valid.push(c);

    // helper to simulate drop
    const simulateDrop = (col)=>{
      for(let r=ROWS-1;r>=0;r--) if(board[r][col]===0) return {r, c:col};
      return null;
    };

    // 1) can AI win immediately?
    for(const c of valid){
      const pos = simulateDrop(c); if(!pos) continue;
      board[pos.r][pos.c]=2;
      const win = checkWin(pos.r,pos.c,2);
      board[pos.r][pos.c]=0;
      if(win) { handleDrop(c, true); return; }
    }
    // 2) block opponent immediate win
    for(const c of valid){
      const pos = simulateDrop(c); if(!pos) continue;
      board[pos.r][pos.c]=1;
      const oppWin = checkWin(pos.r,pos.c,1);
      board[pos.r][pos.c]=0;
      if(oppWin){ handleDrop(c, true); return; }
    }
    // 3) else pick center if available
    const center = 3;
    if(valid.includes(center)){ handleDrop(center, true); return; }
    // 4) else pick random valid
    const choice = valid[Math.floor(Math.random()*valid.length)];
    handleDrop(choice, true);
  }, 420);
}

// events(msg){ messageEl.textContent=msg; setTimeout(()=>{ if(messageEl.textContent===msg) messageEl.textContent=''; },1200); }

// events
document.getElementById('newGame').onclick = ()=> initBoard();
document.getElementById('resetScore').onclick = ()=>{ scores={1:0,2:0}; saveScores(); updateScoreboard(); };
gridEl.addEventListener('click', e=>{ const cell = e.target.closest('.cell'); if(!cell) return; const c = parseInt(cell.dataset.c); if(!isNaN(c)) handleDrop(c); });
window.addEventListener('keydown', e=>{ if(e.key>='1' && e.key<='7') handleDrop(parseInt(e.key)-1); });

// initialize
initBoard();
  </script>
</body>
</html>
